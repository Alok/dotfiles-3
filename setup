#!/bin/bash

mkdir -p ~/history/

# Link dotfiles into ~ and back up the old dotfiles into ~/config-old
find $(cd $(dirname $0) && pwd) -mindepth 1 -maxdepth 1 -not \( \
    -iname '*~' -or \
    -iname '*#*' -or \
    -iname '.hg' -or \
    -iname '.git' -or \
    -iname '.gitmodules' -or \
    -iname 'setup' -or \
    -iname 'backup' -or \
    -iname 'glacier-backup.sh' -or \
    -iname 'misc' -or \
    -iname 'restore' \
    \) -exec bash -c \
    "TARGET=~/\$(basename {})
     echo \"Looking at \$TARGET\"
     if [[ -e \$TARGET && ! -L \$TARGET ]]
     then
         mkdir -p ~/config-old/
         mv \$TARGET ~/config-old/
     fi

     if [[ -L \$TARGET ]]
     then
         rm \$TARGET
     fi

     ln -s {} \$TARGET" \;

# OS X setup
if [ -d $HOME/Library ]; then
    mkdir -p $HOME/Library/KeyBindings
    cp $(cd $(dirname $0) && pwd)/misc/DefaultKeyBinding.dict \
        $HOME/Library/KeyBindings/DefaultKeyBinding.dict
fi
